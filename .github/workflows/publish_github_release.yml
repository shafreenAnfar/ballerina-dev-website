name: Create PR for new Release-note with template

on:
  push:
    branches:
      - master
    paths:
      - '_data/latest/**'

jobs:
  add-release-note:
    runs-on: ubuntu-latest

    steps:    
    - name: Install jq for json manipulation
      run: sudo apt-get install jq

    - name: Checkout code
      uses: actions/checkout@v2

    - name: Create new release in github
      env:
        WEBSITE_TOKEN: ${{ secrets.WEBSITE_TOKEN }}
      run: |
        VERSION="`jq -r '.version' _data/latest/metadata.json`"
        cat downloads/release-notes/$VERSION/RELEASE_NOTE.md | sed '/---/d' | sed '/layout: release-note/d' | sed '/title: Release note/d' > RN.md
        #python script takes RN.md as the input and produces out.json as the output
        python3  .github/scripts/sanitize_rn.py

        curl -H "Authorization: $WEBSITE_TOKEN" -H "Content-Type: application/json" -d @out.json https://api.github.com/repos/shafreenAnfar/ballerina/releases
